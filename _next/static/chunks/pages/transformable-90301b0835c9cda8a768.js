(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63],{7315:function(e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.History=void 0;var t=function(){function e(e,a){this.onChange=a,this.presenceHistoryEntry={state:Object.freeze(e),timeStep:function(){throw"beginning time step can't be executed"},stable:!0,futureHistoryEntry:void 0,pastHistoryEntry:void 0}}return Object.defineProperty(e.prototype,"presence",{get:function(){return this.presenceHistoryEntry.state},enumerable:!1,configurable:!0}),e.prototype.pNext=function(e,a){var t=this.presenceHistoryEntry,n=!a||null!=t.pastHistoryEntry,o={state:Object.freeze(e(t.state)),timeStep:e,futureHistoryEntry:void 0,pastHistoryEntry:n?t:void 0,stable:a};return t.futureHistoryEntry=o,this.presenceHistoryEntry=o,this.onChange(this.presenceHistoryEntry.state),o},e.prototype.next=function(e){this.pNext(e,!0)},e.prototype.maybeNext=function(e){var a=this,t=this.pNext(e,!1);return function(e){if(null==t.pastHistoryEntry)throw"future history event's past entry can't be empty";e?t.stable=!0:(t.pastHistoryEntry.futureHistoryEntry=t.futureHistoryEntry,null!=t.futureHistoryEntry&&(t.futureHistoryEntry.pastHistoryEntry=t.pastHistoryEntry));for(var n=t.pastHistoryEntry;null!=n.futureHistoryEntry;)null==n.pastHistoryEntry&&n.futureHistoryEntry.stable&&(n.futureHistoryEntry.pastHistoryEntry=void 0),n.futureHistoryEntry.state=Object.freeze(n.futureHistoryEntry.timeStep(n.state)),n=n.futureHistoryEntry;e||(a.presenceHistoryEntry=n,a.onChange(a.presenceHistoryEntry.state))}},e.prototype.logStableChain=function(){for(var e=this.presenceHistoryEntry,a=e.stable+"";null!=e.pastHistoryEntry;)a=(e=e.pastHistoryEntry).stable+"->"+a;console.log(a)},e}();a.History=t},8348:function(e,a,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,a,t,n){void 0===n&&(n=t),Object.defineProperty(e,n,{enumerable:!0,get:function(){return a[t]}})}:function(e,a,t,n){void 0===n&&(n=t),e[n]=a[t]}),o=this&&this.__exportStar||function(e,a){for(var t in e)"default"===t||Object.prototype.hasOwnProperty.call(a,t)||n(a,e,t)};Object.defineProperty(a,"__esModule",{value:!0}),o(t(7315),a)},6309:function(e,a,t){"use strict";t.r(a),t.d(a,{Block:function(){return P},TransformableExamplePage:function(){return _},default:function(){return Z},useSyncTransformable:function(){return A}});var n=t(7378),o=t(4658),s=t(2212),c=t(5671),p=t(3144),r=t(7326),m=t(9340),k=t(6215),N=t(1120),u=t(4942),l=t(3349),d=t(8348),i=t(6092),y=t(2834),f=t(9148);function w(e){var a=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,N.Z)(e);if(a){var o=(0,N.Z)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,k.Z)(this,t)}}var b=function(e){(0,m.Z)(t,e);var a=w(t);function t(e,n){var o;return(0,c.Z)(this,t),o=a.call(this),(0,u.Z)((0,r.Z)(o),"state",void 0),(0,u.Z)((0,r.Z)(o),"history",void 0),(0,u.Z)((0,r.Z)(o),"subscriber",l.Subscriber.create(t,(function(e,a,t){var n=o.state.getState();a(n.matrix,n.owner)}))),(0,u.Z)((0,r.Z)(o),"setLock",l.Request.create((0,r.Z)(o),"setSliderLock",(function(e,a){if(null!=e)return o.forceLock(a),o.forceLock.publishTo({to:"all-except-one",except:e},a),(0,i.of)(!0);var t=o.history.maybeNext((function(e){var t=e.matrix;return{owner:a,matrix:t}}));return o.setLock.publishTo(o.mainLink,a).pipe((0,y.b)((function(e){return t(e)})))}))),(0,u.Z)((0,r.Z)(o),"forceLock",l.Action.create((0,r.Z)(o),"forceLock",(function(e,a){o.history.next((function(e){var t=e.matrix;return{owner:a,matrix:t}}))}))),(0,u.Z)((0,r.Z)(o),"transform",l.Action.create((0,r.Z)(o),"transform",(function(e,a,t){o.history.next((function(e){return e.owner!=a?e:{owner:e.owner,matrix:t}})),o.history.presence.owner==a&&o.transform.publishTo(null==e?{to:"all"}:{to:"all-except-one",except:e},a,t)}))),o.state=(0,f.Z)((function(){return{matrix:e,owner:n}})),o.history=new d.History(o.state.getState(),(function(e){return o.state.setState(e)})),o}return(0,p.Z)(t,[{key:"onUnlink",value:function(e){this.history.presence.owner===e.connection.userData.id&&(this.forceLock("none"),this.forceLock.publishTo({to:"all"},"none"))}},{key:"onLink",value:function(e){}}]),t}(l.Store),h=t(8077),x=t(4467),g=t(1655),v=t(7462),S=t(4925),E=t(3905),L=["components"],H={};function j(e){var a=e.components,t=(0,S.Z)(e,L);return(0,E.kt)("wrapper",(0,v.Z)({},H,t,{components:a,mdxType:"MDXLayout"}),(0,E.kt)("h1",null,"Transformable Example"),(0,E.kt)("p",null,"Transform a 3D cube collaboratively and prevent simultaneous transformation by multiple clients using lock functionality."),(0,E.kt)("h1",null,"Source Code"),(0,E.kt)("p",null,(0,E.kt)("a",{parentName:"p",href:"https://github.com/cocoss-org/co-share/blob/master/examples/stores/transformable.ts"},(0,E.kt)("inlineCode",{parentName:"a"},"transformable.ts"))),(0,E.kt)("pre",{className:"language-typescript"},(0,E.kt)("code",{parentName:"pre",className:"language-typescript"},(0,E.kt)("span",{parentName:"code",className:"token keyword module"},"export")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"class")," ",(0,E.kt)("span",{parentName:"code",className:"token class-name"},(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"TransformableStore"))," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"extends")," ",(0,E.kt)("span",{parentName:"code",className:"token class-name"},(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Store"))," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"public")," state",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreApi"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," matrix",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Array"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},";")," owner",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"private")," history",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"History"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," matrix",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Array"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},";")," owner",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},"onUnlink"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"link",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreLink"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"history"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"presence"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"owner")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"===")," link",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"connection"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"userData"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"id"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"forceLock"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token string"},'"none"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"forceLock"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"all"')," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"none"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},"onLink"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"link",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"StoreLink"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"public")," subscriber",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Subscriber"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"TransformableStore"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,E.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Array"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Subscriber"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"TransformableStore"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"connection",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," accept",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," deny",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," s ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"getState"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token function"},"accept"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"s",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"matrix"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," s",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"owner"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token function"},"constructor"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"matrix",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Array"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," owner",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"super"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"state")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},"create"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," matrix",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," owner ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"history")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,E.kt)("span",{parentName:"code",className:"token class-name"},(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"History")),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"getState"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"presence",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"setState"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"presence",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n    setLock",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Request"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"boolean"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Request"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"setSliderLock"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," owner",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"!=")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword null nil"},"null"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"forceLock"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"owner",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"forceLock"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"all-except-one"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," except",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," origin ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," owner",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"of"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token boolean"},"true"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"else")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," resolve ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"history"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"maybeNext"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," matrix ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," owner",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," matrix ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"setLock"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"mainLink"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," owner",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"pipe"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token function"},"tap"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"keep",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},"resolve"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"keep",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"private")," forceLock ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Action"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"forceLock"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," owner",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"history"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"next"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," matrix ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            owner",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            matrix",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    transform ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Action"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"create"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"transform"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," by",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," matrix",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Array"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"history"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"next"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"state",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"state",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"owner")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"!=")," by",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," state\n            ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                owner",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," state",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"owner"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n                matrix",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"history"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"presence"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"owner")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"!=")," by",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"this"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"transform"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"publishTo"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"origin ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"==")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword null nil"},"null")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"?")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"all"')," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," to",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"all-except-one"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," except",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," origin ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," by",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," matrix",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n")),(0,E.kt)("p",null,(0,E.kt)("a",{parentName:"p",href:"https://github.com/cocoss-org/co-share/blob/master/examples/pages/transformable.tsx"},(0,E.kt)("inlineCode",{parentName:"a"},"transformable.tsx"))),(0,E.kt)("pre",{className:"language-typescript"},(0,E.kt)("code",{parentName:"pre",className:"language-typescript"},(0,E.kt)("span",{parentName:"code",className:"token keyword module"},"export")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"function")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"TransformableExamplePage")),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," rootStore ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," rootStore",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"RootStore")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token constant"},"JSX"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Element"))," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," store ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},"useStoreSubscription"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"transformable"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token number"},"1000"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"matrix",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token known-class-name class-name"},"Array"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token builtin"},"number"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," owner",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,E.kt)("span",{parentName:"code",className:"token class-name"},(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"TransformableStore")),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"matrix",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," owner",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword nil"},"undefined"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},","),"\n        rootStore\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," id ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},"useMemo"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," rootStore",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"mainLink"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"connection"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"userData"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"id"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"["),"rootStore",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Canvas")," style",(0,E.kt)("span",{parentName:"code",className:"token operator"},"="),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," touchAction",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token string"},'"none"')," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),"ambientLight ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"/"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),"pointLight position",(0,E.kt)("span",{parentName:"code",className:"token operator"},"="),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,E.kt)("span",{parentName:"code",className:"token number"},"10"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token number"},"10"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token number"},"10"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"/"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Block")," store",(0,E.kt)("span",{parentName:"code",className:"token operator"},"="),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"store",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}")," id",(0,E.kt)("span",{parentName:"code",className:"token operator"},"="),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"id",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"/"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"/"),(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"Canvas"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",(0,E.kt)("span",{parentName:"code",className:"token keyword module"},"export")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"function")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Block")),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," store",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," id ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," store",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token maybe-class-name"},"TransformableStore"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},";")," id",(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token builtin"},"string")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token operator"},":")," ",(0,E.kt)("span",{parentName:"code",className:"token constant"},"JSX"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Element"))," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," grabbedRef ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},"useRef"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token boolean"},"false"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," helperArray ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token generic-function"},(0,E.kt)("span",{parentName:"span",className:"token function"},"useMemo"),(0,E.kt)("span",{parentName:"span",className:"token generic class-name"},(0,E.kt)("span",{parentName:"span",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"span",className:"token known-class-name class-name"},"Array"),(0,E.kt)("span",{parentName:"span",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"span",className:"token builtin"},"number"),(0,E.kt)("span",{parentName:"span",className:"token operator"},">>"))),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," mesh ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token generic-function"},(0,E.kt)("span",{parentName:"span",className:"token function"},"useRef"),(0,E.kt)("span",{parentName:"span",className:"token generic class-name"},(0,E.kt)("span",{parentName:"span",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Mesh"),(0,E.kt)("span",{parentName:"span",className:"token operator"},">"))),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token keyword null nil"},"null"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," camera ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},"useThree"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," camera ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," camera",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," ownerRef ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token function"},"useSyncTransformable"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"store",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"state"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," mesh",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token function"},"useFrame"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{")," mouse ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"grabbedRef",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"current"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," position ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"new")," ",(0,E.kt)("span",{parentName:"code",className:"token class-name"},(0,E.kt)("span",{parentName:"span",className:"token maybe-class-name"},"Vector3")),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"mouse",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"x"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," mouse",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"y"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token number"},"0"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            position",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"applyMatrix4"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"camera",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"projectionMatrixInverse"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            position",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"multiplyScalar"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"camera",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"position"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"z")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"/")," position",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"z"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            helperMatrix",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"identity"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            helperMatrix",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"setPosition"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token operator"},"-"),"position",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"x"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"-"),"position",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"y"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token number"},"0"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            helperMatrix",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"toArray"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"helperArray",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            store",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"transform"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"id",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," helperArray",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token function"},"useEffect"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword"},"const")," ",(0,E.kt)("span",{parentName:"code",className:"token function-variable function"},"onPointerUp")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"id ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"==")," ownerRef",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"current"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                grabbedRef",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"current")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token boolean"},"false"),"\n                store",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"setLock"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token string"},'"none"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"subscribe"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"approved",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                    ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token operator"},"!"),"approved",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                        grabbedRef",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"current")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token boolean"},"true"),"\n                    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n                ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token dom variable"},"window"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"addEventListener"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token string"},'"mouseup"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," onPointerUp",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token dom variable"},"window"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"removeEventListener"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token string"},'"mouseup"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," onPointerUp",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"["),"id",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," store",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n\n    ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"return")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),"mesh\n            ref",(0,E.kt)("span",{parentName:"code",className:"token operator"},"="),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"mesh",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n            onPointerDown",(0,E.kt)("span",{parentName:"code",className:"token operator"},"="),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                store",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"setLock"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"id",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token method function property-access"},"subscribe"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),"approved",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token arrow operator"},"=>")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                    ",(0,E.kt)("span",{parentName:"code",className:"token keyword control-flow"},"if")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"("),(0,E.kt)("span",{parentName:"code",className:"token operator"},"!"),"approved",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),"\n                        grabbedRef",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"current")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token boolean"},"false"),"\n                    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n                ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n                grabbedRef",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"."),(0,E.kt)("span",{parentName:"code",className:"token property-access"},"current")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"=")," ",(0,E.kt)("span",{parentName:"code",className:"token boolean"},"true"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),"boxGeometry args",(0,E.kt)("span",{parentName:"code",className:"token operator"},"="),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"["),(0,E.kt)("span",{parentName:"code",className:"token number"},"1"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token number"},"1"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},",")," ",(0,E.kt)("span",{parentName:"code",className:"token number"},"1"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"]"),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"/"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n            ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),"meshStandardMaterial color",(0,E.kt)("span",{parentName:"code",className:"token operator"},"="),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"{"),(0,E.kt)("span",{parentName:"code",className:"token string"},'"orange"'),(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}")," ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"/"),(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n        ",(0,E.kt)("span",{parentName:"code",className:"token operator"},"<"),(0,E.kt)("span",{parentName:"code",className:"token operator"},"/"),"mesh",(0,E.kt)("span",{parentName:"code",className:"token operator"},">"),"\n    ",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},")"),"\n",(0,E.kt)("span",{parentName:"code",className:"token punctuation"},"}"),"\n")))}j.isMDXComponent=!0;var R=t(9138),M=t(4246);function Z(){return(0,M.jsxs)("div",{className:"d-flex flex-column fullscreen",children:[(0,M.jsx)(g.h,{selectedIndex:6}),(0,M.jsxs)("div",{className:"d-flex flex-column justify-content-stretch container-lg",children:[(0,M.jsx)("div",{className:"d-flex flex-row-responsive",children:(0,M.jsx)(x.X,{twoClients:!0,initStores:function(e){return e.addStore(new b([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],"none"),"transformable")},children:function(e){return(0,M.jsx)(_,{rootStore:e})}})}),(0,M.jsx)("div",{className:"p-3 flex-basis-0 flex-grow-1",children:(0,M.jsx)(j,{})})]}),(0,M.jsx)(R.$,{})]})}var T=new s.Matrix4;function A(e,a){var t=(0,n.useMemo)((function(){return new s.Matrix4}),[]),o=(0,n.useRef)(e.getState().owner);return(0,n.useEffect)((function(){var n=function(e){var n=e.matrix,s=e.owner;o.current=s,null!=a.current&&(t.fromArray(n),a.current.position.setFromMatrixPosition(t),a.current.scale.setFromMatrixScale(t),a.current.quaternion.setFromRotationMatrix(t))};return n(e.getState()),e.subscribe(n)}),[e]),{ownerRef:o}}function _(e){var a=e.rootStore,t=(0,h.useStoreSubscription)("transformable",1e3,(function(e,a){return new b(e,a)}),void 0,a),s=(0,n.useMemo)((function(){return a.mainLink.connection.userData.id}),[a]);return(0,M.jsxs)(o.Xz,{style:{touchAction:"none"},children:[(0,M.jsx)("ambientLight",{}),(0,M.jsx)("pointLight",{position:[10,10,10]}),(0,M.jsx)(P,{store:t,id:s})]})}function P(e){var a=e.store,t=e.id,c=(0,n.useRef)(!1),p=(0,n.useMemo)((function(){return[]}),[]),r=(0,n.useRef)(null),m=(0,o.Ky)((function(e){return e.camera})),k=A(a.state,r).ownerRef;return(0,o.xQ)((function(e){var n=e.mouse;if(c.current){var o=new s.Vector3(n.x,n.y,0);o.applyMatrix4(m.projectionMatrixInverse),o.multiplyScalar(m.position.z/o.z),T.identity(),T.setPosition(-o.x,-o.y,0),T.toArray(p),a.transform(t,p)}})),(0,n.useEffect)((function(){var e=function(){t==k.current&&(c.current=!1,a.setLock("none").subscribe((function(e){e||(c.current=!0)})))};return window.addEventListener("mouseup",e),function(){return window.removeEventListener("mouseup",e)}}),[t,a]),(0,M.jsxs)("mesh",{ref:r,onPointerDown:function(){a.setLock(t).subscribe((function(e){e||(c.current=!1)})),c.current=!0},children:[(0,M.jsx)("boxGeometry",{args:[1,1,1]}),(0,M.jsx)("meshStandardMaterial",{color:"orange"})]})}},9908:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/transformable",function(){return t(6309)}])}},function(e){e.O(0,[737,667,377,60,100,774,888,179],(function(){return a=9908,e(e.s=a);var a}));var a=e.O();_N_E=a}]);